!function(a,b){"function"==typeof define&&(define.cmd||define.amd)?define(function(){return b(a)}):a.lazyloadimages=b(a)}(this,function(a){function b(b){b=b||{};var d;for(d in b)this[d]=b[d];this.ct=document.body,this._scroll_=i(this._scroll,this),c&&(this.useFade=!1),a.addEventListener("scroll",this._scroll_,!1),this.maxScrollY=0,this._onpageshow_=i(this._onpageshow,this),this.elements=[],this.lazyElements={},a.addEventListener("pageshow",this._onpageshow_,!1),this.scan(this.ct)}var c=/android/i.test(a.navigator.userAgent.toLowerCase()),d=document.createElement("div").style,e=function(){for(var a,b,c="t webkitT mozT oT msT".split(" "),e=(c.length,0);b=c[e];e++)if(a=b+"ransform",a in d)return b.substring(0,b.length-1)}(),f=function(){return"webkit"==e||"O"===e?e.toLowerCase()+"TransitionEnd":"transitionend"}(),g=function(a,b,c){var d=this,e=function(){a.transitionTimer&&clearTimeout(a.transitionTimer),a.transitionTimer=null,a.removeEventListener(f,g,!1)},g=function(){e(),c&&c.call(d)};e(),a.addEventListener(f,g,!1),a.transitionTimer=setTimeout(g,b+100)},h=function(a,b){var c;for(c in b)a[c]=b[c];return a},i=function(a,b,c){return function(){var d=c?Array.prototype.concat.call(arguments,c):arguments;a.apply(b,d)}};return h(b.prototype,{realSrcAttr:"data-src",completedAttr:"data-load-completed",range:200,useFade:!0,_onpageshow:function(b){b.persisted&&(this.maxScrollY=0,a.scrollTo(0,0))},getScrollY:function(){return a.pageYOffset||a.scrollY},_scroll:function(){var a=this.getScrollY();a>this.maxScrollY&&(this.maxScrollY=a,this._scrollAction())},_scrollAction:function(){clearTimeout(this.lazyLoadTimeout),this.elements=this.elements.filter(function(a){if(this.range+window.innerHeight>=a.getBoundingClientRect().top+document.documentElement.clientTop){var b=a.getAttribute(this.realSrcAttr);return b&&(this.lazyElements[b]?this.lazyElements[b].push(a):this.lazyElements[b]=[a]),!1}return!0},this),this.lazyLoadTimeout=setTimeout(i(this._loadImage,this),c?200:0)},_loadImage:function(){var a,b,c;for(b in this.lazyElements)if(c=this.lazyElements[b],a=c.shift(),0==c.length&&delete this.lazyElements[b],"img"==a.nodeName.toLowerCase()&&1==a.nodeType)a.addEventListener("load",i(this._onImgLoad,this),!1),a.src!=b?this._setImgSrc(a,b):this._onImgLoad(a);else{if(1!=a.nodeType)continue;var d=new Image;d.setAttribute(this.realSrcAttr,a.getAttribute(this.realSrcAttr)),d.addEventListener("load",i(this._onImgLoad,this,a),!1),d.src!=b&&this._setImgSrc(d,b)}},_onImgLoad:function(a,b){var c=this,d=b||a.target||a,e=d.getAttribute(this.realSrcAttr),f=c.lazyElements[e];c._showImage(d),f&&(f.forEach(function(a){"img"==a.nodeName.toLowerCase()&&1==a.nodeType&&c._setImgSrc(a,e,d),c._showImage(a)}),delete c.lazyElements[e])},_setImgSrc:function(a,b){this.useFade&&(a.style.opacity="0"),a.src=b},_setImgBackground:function(a,b){a&&(a.style.backgroundImage="url("+b+")")},_showImage:function(a){var b=this,c=function(){a.setAttribute(b.completedAttr,"1")};"img"!=a.nodeName.toLowerCase()&&(this._setImgBackground(a,a.getAttribute(this.realSrcAttr)),c()),b.useFade?(a.style[e+"Transition"]="opacity 600ms",a.style.opacity=1,g(a,200,c)):c()},scan:function(a){var b;a=a||document.body,b=a.querySelectorAll("["+this.realSrcAttr+"]")||[],b=Array.prototype.slice.call(b,0),b.filter(function(a){return 1==a.getAttribute(this.completedAttr)?!1:!0},this),this.elements=this.elements.concat(b),this._scrollAction()}}),d=null,b});